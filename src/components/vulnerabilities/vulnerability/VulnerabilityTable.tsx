
import React from "react";
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from "@/components/ui/table";
import { Button } from "@/components/ui/button";
import { Database } from "@/integrations/supabase/types";
import { SeverityBadge } from "@/components/dashboard/vulnerability/SeverityBadge";
import { StatusBadge } from "@/components/dashboard/vulnerability/StatusBadge";
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar";

type Vulnerability = Database['public']['Tables']['vulnerabilities']['Row'] & {
  team_members?: {
    name: string;
    avatar_url: string | null;
  } | null;
};

interface VulnerabilityTableProps {
  vulnerabilities: Vulnerability[];
  loading: boolean;
  formatTimeAgo: (dateString: string | null) => string;
  customColumns?: {
    nameHeader?: string;
  };
}

export const VulnerabilityTable = ({ 
  vulnerabilities, 
  loading, 
  formatTimeAgo,
  customColumns
}: VulnerabilityTableProps) => {
  if (loading) {
    return <div className="py-8 text-center text-muted-foreground">Loading vulnerabilities...</div>;
  }

  if (vulnerabilities.length === 0) {
    return (
      <div className="py-8 text-center text-muted-foreground">
        No vulnerabilities found in this category.
      </div>
    );
  }

  return (
    <Table>
      <TableHeader>
        <TableRow>
          <TableHead>{customColumns?.nameHeader || "Vulnerability"}</TableHead>
          <TableHead>Severity</TableHead>
          <TableHead>Status</TableHead>
          <TableHead>Assigned To</TableHead>
          <TableHead>Detected</TableHead>
          <TableHead className="text-right">Actions</TableHead>
        </TableRow>
      </TableHeader>
      <TableBody>
        {vulnerabilities.map((vuln) => (
          <TableRow key={vuln.id}>
            <TableCell className="font-medium">
              <div className="flex items-center gap-2">
                <StatusBadge status={vuln.status} />
                <span>{vuln.name}</span>
              </div>
            </TableCell>
            <TableCell><SeverityBadge severity={vuln.severity} /></TableCell>
            <TableCell>
              {vuln.status === "fixed" ? (
                <span className="inline-flex items-center gap-1 text-green-600">
                  <span>Fixed</span>
                </span>
              ) : (
                <span className="inline-flex items-center gap-1 text-amber-600">
                  <span>Open</span>
                </span>
              )}
            </TableCell>
            <TableCell>
              {vuln.team_members ? (
                <div className="flex items-center gap-2">
                  <Avatar className="h-6 w-6">
                    {vuln.team_members.avatar_url && (
                      <AvatarImage src={vuln.team_members.avatar_url} alt={vuln.team_members.name} />
                    )}
                    <AvatarFallback>
                      {vuln.team_members.name.substring(0, 2).toUpperCase()}
                    </AvatarFallback>
                  </Avatar>
                  <span>{vuln.team_members.name}</span>
                </div>
              ) : (
                <span className="text-muted-foreground">Unassigned</span>
              )}
            </TableCell>
            <TableCell>
              {formatTimeAgo(vuln.detected)}
            </TableCell>
            <TableCell className="text-right">
              <div className="flex items-center justify-end gap-2">
                {vuln.status === "fixed" ? (
                  <Button variant="outline" size="sm">View Details</Button>
                ) : (
                  <>
                    <Button variant="outline" size="sm">Ignore</Button>
                    <Button size="sm">Fix Issue</Button>
                  </>
                )}
              </div>
            </TableCell>
          </TableRow>
        ))}
      </TableBody>
    </Table>
  );
};
